<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>{L('member','','member').L('manage_center')}</title>
    <link rel="stylesheet" type="text/css" href="{CSS_PATH}animate.min.css">
    <link rel="stylesheet" type="text/css" href="{CSS_PATH}edit_address.css">
    <script src="{JS_PATH}jquery-3.2.1.min.js"></script>
    <script src="{JS_PATH}jquery.validate.zh.min.js"></script>
    <script src="{JS_PATH}card.js"></script>
    <script src="{JS_PATH}common.js"></script>
</head>
 <!-- 头部 -->
    <header>
        <div class="container">
            <div class="con_top">
                <p>
                    <span>欢迎来到橙子家！</span>
                    <img src="{IMG_PATH}w_erwu.png" alt="">
                    <span>400-000-000</span>
                    <img src="{IMG_PATH}1_i9qh.png" alt="">
                    <span>xx@163.com</span>
                    <span><a href="/index.php?m=member&c=index&a=register&siteid=1">注册</a></span>/<span><a href="/index.php?m=member&c=index&a=login">登录</a></span>
                </p>
            </div>
            <div class="con_center">
                <img class="wow fadeInLeft" src="{IMG_PATH}logo.ico" alt="" style="width: 5%;">
                <div class="wow fadeInLeft">
                    <p>橙子家海外物流转运</p>
                    <p>The Orange</p>
                </div>
                    <ul id="navBar" class="con_ul wow fadeInRight">
                        <!--<li class="active active-jq"><a href="/index.php?">首页</a></li> -->
                        <li ><a href="/index.php?">首页</a></li>
                        <li><a href="/index.php?m=content&c=index&a=lists&catid=2">关于我们</a></li>
                        <li><a href="/index.php?m=express&c=index&a=init">我的转运</a></li>
                        <li><a href="#">产品与服务</a></li>
                        <li><a href="#">会员计划</a></li>
                        <li><a href="#">联系我们</a></li>
                    </ul>
            </div>
        </div>
    </header>
<!-- 添加/编辑地址 -->
<div id="content" style="margin-top:50px;">
<div class="content_detail">
<div class="common_panel">
<div class="panel_header">添加国内收货地址</div>
<form accept-charset="UTF-8" action="" class="new_user_address" enctype="multipart/form-data" id="new_user_address" method="post" novalidate="novalidate">
  <div style="display:none">
    <input type="hidden" name="siteid" value="{$siteid}" />
  <input type="hidden" name="address_id" value="{$address_id}" />
  <input type="hidden" name="dosubmit" value="dosubmit" />
  </div>
  <div class="panel_content">
    <table class="common_form">
      <tbody>
        <tr>
          <td>
            <table class="common_form">
            <tbody>
            <tr>
            <td>为了保证顺利转运，请按如下样式:</td>
            </tr>
            <tr>
            <td><img src="{IMG_PATH}idcard_pic.jpg" title="身份证上传模版"></td>
            </tr>
            </tbody>
            </table>
            </td>
            <td>
            <table class="common_form">
              <tbody>
                <tr>
                  <td class="label"><em>(必填)</em>收货人姓名</td>
                  <td class="item"><input class="textbox" id="user_address_cname" name="info[consignee]" type="text" value="{$member_address_info['consignee']}"></td>
                  <td class="info"></td>
                </tr>
                <tr>
                  <td class="label"><em>(必填)</em>身份证号码</td>
                  <td class="item"><input class="textbox" id="user_address_identity_card" name="info[idcard]" type="text"  value="{$member_address_info['idcard']}"></td>
                  <td class="info"></td>
                </tr>
                <tr>
                  <td class="label"><em>(必填)</em>上传身份证(正面)</td>
                  <td class="item"><input id="identity_card_picture_path1" name="idfront" style="width:200px;" type="file"></td>
                  <td class="info"><span class="notice">(5MB以下jpg/png)</span></td>
                </tr>
                <tr>
                  <td class="label"><em>(必填)</em>上传身份证(背面)</td>
                  <td class="item"><input id="identity_card_picture_path2" name="idback" style="width:200px;" type="file"></td>
                  <td class="info"><span class="notice">(5MB以下jpg/png)</span></td>
                </tr>
                <tr>
                  <td class="label"><em>(必填)</em>收货省市辖区</td>
                  <td class="item">
                    <select id="region_city_selector_region" name="info[province]">
                      <option value="">请选择</option>
                      {loop $province_list  $p}           
                      <option value="{$p['cityname']}" "{if $p['cityname'] eq {$member_address_info['province']} } selected {/if}" >{$p['cityname']}</option>
                      {/loop}
                    </select>
                    <select id="region_city_selector_city" name="info[city]" >
                      <option value="">请选择</option>
                      {loop $city_list  $p}           
                      <option value="{$p['cityname']}" "{if $p['cityname'] eq {$member_address_info['city']} } selected {/if}" >{$p['cityname']}</option>
                      {/loop}
        
                    </select>
                    <select id="region_city_selector_district" name="info[area]" >
                      <option value="">请选择</option>
                       {loop $area_list  $p}           
                      <option value="{$p['cityname']}" "{if $p['cityname'] eq {$member_address_info['area']} } selected {/if}" >{$p['cityname']}</option>
                      {/loop}
                    </select>
                  </td>
                  <td class="info"></td>
                </tr>
                <tr>
                  <td class="label"><em>(必填)</em>收货街道门牌号</td>
                  <td class="item"><input class="textbox" id="user_address_address" name="info[addressinfo]" type="text" value="{$member_address_info['addressinfo']}"></td>
                  <td class="info"><span class="notice">请勿重复填写省市辖区</span></td>
                </tr>
                <tr>
                  <td class="label"><em>(必填)</em>收货邮编</td>
                  <td class="item"><input class="textbox" id="user_address_zip_code" name="info[zipcode]" type="text" value="{$member_address_info['zipcode']}"></td>
                  <td class="info"></td>
                </tr>
                <tr>
                  <td class="label"><em>(必填)</em>收货人手机</td>
                  <td class="item"><input class="textbox" id="user_address_mobile" name="info[mobile]" type="text" value="{$member_address_info['mobile']}"></td>
                  <td class="info"></td>
                </tr>
        <!--
                <tr>
                  <td class="label">收货人电话</td>
                  <td class="item"><input class="textbox" id="user_address_telephone" name="member_address_info[telephone]" type="text"></td>
                  <td class="info"></td>
                </tr>
        -->
                <tr>
                  <td class="label"><em>(必填)</em>收货人Email</td>
                  <td class="item"><input class="textbox" id="user_address_email" name="info[email]" type="text" value="{$member_address_info['email']}"></td>
                  <td class="info"></td>
                </tr>
              </tbody>
            </table>
          </td>
        </tr>
    </tbody>
  </table>
  </div>
  <div class="panel_footer">
  <div class="submit_button"><a href="#this" id="submit">确认提交</a><a class="previous_button" href="#">取消返回</a></div>
  </div>
</form>
    </div>
  </div>
</div>
<!-- 添加/编辑地址 -->


<script>
        $(document).ready(function(){
            $(".con_ul li").mouseenter(function(){
                $(this).addClass("active").siblings().removeClass("active");
            }).mouseout(function() {
                $(".active-jq").addClass("active ").siblings().removeClass("active");
            });
            $(".con_ul li").click(function(){
                $(this).addClass("active-jq").siblings().removeClass("active-jq");
            });
        });

    </script>

<script type="text/javascript">
  $(function () {
    jQuery.validator.addMethod("isMobile", function (value, element) {
      var length = value.length;
      var mobile = /^((1[0-9]{2})+\d{8})$/;
      return this.optional(element) || (length == 11 && mobile.test(value));
    }, "请正确填写您的手机号码");

    jQuery.validator.addMethod("isIdCardNo", function(value, element) {
      return this.optional(element) || idCardNoUtil.checkIdCardNo(value) || idCardNoUtil.checknumber(value) || idCardNoUtil.checkTaiwanCardNo(value);
    }, "请正确填写您的身份证或护照号码");

    jQuery.validator.addMethod("isCName", function (value, element) {
      return this.optional(element) || /^[\u4DAE\u4E00-\u9FA5]+$/.test(value);
    }, "请输入中文姓名");

    jQuery.validator.addMethod("validates_district", function (value, element) {
      return /^[\u4DAE\u4E00-\u9FA5]+$/.test(value);
    }, "请选择收货省市辖区");

    $("form:first").validate({
      ignore : '',
      rules: {
        "user_address[cname]": {
          required: true,
          isCName: true
        },
        "user_address[identity_card]": {
          required: true,
          isIdCardNo: true
        },
        "user_address[district]": {
          validates_district: true
        },
        "user_address[address]": {
          required: true
        },
        "user_address[zip_code]": {
          required: true,
          number: true
        },
        "user_address[mobile]": {
          required: true,
          isMobile: true
        },
        "user_address[email]": {
          required: true,
          email: true
        }
      }
    });

    var has_identity_card_path = "no";
    var check_identity_card_path = function(){
      var ic_path1 = $('#identity_card_picture_path1').val();
      var ic_path2 = $('#identity_card_picture_path2').val();
      if(has_identity_card_path == 'yes'){
        return true;
      }
      if(ic_path1 == '' && ic_path2 == ''){
        $('span.notice').addClass('alert').text('请上传证件图片');
        return false;
      }
      return true;
    }

    $('#identity_card_picture_path1,#identity_card_picture_path2').change(function(){
      var ic_path1 = $('#identity_card_picture_path1').val();
      var ic_path2 = $('#identity_card_picture_path2').val();
      if(ic_path1 != '' || ic_path2 != '') {
        has_identity_card_path = 'yes';
        $('span.notice').removeClass('alert').text('(5MB以下jpg/png)')
      } else {
        has_identity_card_path = 'no'
      }
    })
    $("#submit").click(function () {
      if ($("form:first").valid() && check_identity_card_path()) {
        $("form:first").submit();
      }
      return false;
    });
  });
</script>
<script type="text/javascript">
var lu_region_params = {"安徽":1,"北京":3,"福建":4,"甘肃":5,"广东":6,"广西":7,"贵州":8,"海南":9,"河北":10,"河南":11,"黑龙江":12,"湖北":13,"湖南":14,"吉林":15,"江苏":16,"江西":17,"辽宁":18,"内蒙古":19,"宁夏":20,"青海":21,"山东":22,"山西":23,"陕西":24,"上海":25,"四川":26,"天津":28,"西藏":29,"新疆":31,"云南":32,"浙江":33,"重庆":34};
var region_city_params = "";

$(function() {
  var $user_address_lu_region_id = $("#user_address_lu_region_id");
  var $user_address_lu_region_name = $("#user_address_lu_region_name");
  var $user_address_city = $("#user_address_city");
  var $user_address_district = $("#user_address_district");

  var $region_city_selector_region = $("#region_city_selector_region");
  var $region_city_selector_city = $("#region_city_selector_city");
  var $region_city_selector_district = $("#region_city_selector_district");

  var funChangeSelect=function(obj,fname){
        if (fname=="")
        {
          return false;
        }
         $.ajax({

             type: "GET",

             url: "/index.php?m=member&c=index&a=public_province_ajax&fname="+fname,

             data: {},

             dataType: "json",

             success: function(data){

                         if (data.data) {
                            var html = '<option>请选择</option>'; 
                              $.each(data, function(commentIndex, comment){
                                   html += '<option value="'+comment['cityname']+'">'+comment['cityname']+'</option>';
                             });
                            obj.html(html);
                         } 

                      }

         });

  $region_city_selector_region.change(function() {
    var region_name = $region_city_selector_region.val();
    if (region_name != "") {
      funChangeSelect($region_city_selector_city,region_name)
    }

  });

  $region_city_selector_city.change(function() {
    var city_name = $region_city_selector_city.val();
    if (city_name != "") {
      funChangeSelect($region_city_selector_district,city_name)
    }
  });
  
</script>
{template 'content', 'footer'}